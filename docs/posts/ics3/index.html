<!doctype html>

<html lang="en">

<head>
  <title>ICS 笔记3 - Colin&#39;s Blog</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="A C&#43;&#43; Programmer" />
<meta name="author" content="Oyyko" /><meta property="og:title" content="ICS 笔记3" />
<meta property="og:description" content="ICS笔记3" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.oyyko.com/posts/ics3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-08-01T12:18:15+08:00" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="ICS 笔记3"/>
<meta name="twitter:description" content="ICS笔记3"/>

<meta name="generator" content="Hugo 0.124.1">
    

  <link rel="stylesheet" href="/css/normalize.min.css" />
  <link rel="stylesheet" href="https://blog.oyyko.com/fontawesome/css/all.min.css" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css" />
</head>

<body>
  <div id="container">
    <header>
      
      <h1>
        <a href="/">Colin&rsquo;s Blog</a>
      </h1>

      <ul id="social-media">
             <li>
               <a href="mailto:finalwind42@gmail.com" title="Email me">
               <i class="fas fa-envelope fa-lg"></i>
               </a>
             </li>
             <li>
               <a href="https://github.com/oyyko" title="GitHub">
               <i class="fab fa-github fa-lg"></i>
               </a>
             </li>
             <li>
               <a href="https://linkedin.com/in/col-z" title="LinkedIn">
               <i class="fab fa-linkedin fa-lg"></i>
               </a>
             </li>
      </ul>
      
      <p><em>A C++ Programmer</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="/about">
                <i class="fa-li fa  fa-lg"></i><span>About</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/posts">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/tags">
                <i class="fa-li fa  fa-lg"></i><span>Tags</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>




<article>

    <h1>ICS 笔记3</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2021-12-19T00:00:00Z">Dec 19, 2021</time>
        </li>
        
        <li>
            Modified on <time datetime="2023-08-01T12:18:15&#43;08:00">Aug 1, 2023</time>
        </li>
        
        

        
        <li>
            <em>
                
                    
                    <a href="/tags/ics">#ICS</a>
                
            </em>
        </li>
        

        <li>3 minute read</li>
    </ul>
</aside>

    

    
      

    

    <p>ICS笔记3</p>
<h2 id="chapter8-1-subroutines">Chapter8-1 Subroutines</h2>
<h3 id="adt-abstract-data-types">ADT Abstract Data Types</h3>
<p>Up to now, we have processed a single value</p>
<ul>
<li>an integer</li>
<li>a floating point number, or</li>
<li>an ASCII character</li>
</ul>
<p>The real world is <strong>abstract data types</strong>, or more colloquially data structures，far more complex than simple, single numbers. E.g.</p>
<ul>
<li>a company’s organization chart</li>
<li>a list of items arranged in alphabetical order</li>
</ul>
<p>In this chapter, we will study three abstract data types:</p>
<ul>
<li>stacks</li>
<li>queues</li>
<li>and character strings</li>
</ul>
<p>Before we get to stacks, queues, and character strings, however, we introduce a new concept that will prove very useful in manipulating data structures: <strong>subroutines, or what is also called functions</strong>.</p>
<h3 id="subroutine">Subroutine</h3>
<p>A subroutine is a program fragment that. . .</p>
<ul>
<li>Resides in user space (i.e, not in OS)</li>
<li>Performs a well-defined task</li>
<li>Is invoked (called) multiple times by a user program</li>
<li>Returns control to the calling program when finished</li>
</ul>
<p>Virtues:</p>
<ul>
<li>Reuse code without re-typing it (and debugging it!)</li>
<li>Divide task into parts (or among multiple programmers)</li>
<li>Use vendor-supplied library of useful routines that one software engineer writes a program that requires such fragments and another software engineer writes the fragments.
<ul>
<li>math library</li>
<li>square root, sine, and arctangent,etc.</li>
</ul>
</li>
</ul>
<p>Important: <strong>The Call/Return Mechanism</strong></p>
<h3 id="相关的指令">相关的指令</h3>
<p>JSR,JSRR,RET</p>
<h3 id="jsr">JSR</h3>
<p>0100 1 PCoffset11
作用：跳转，并且把之前的PC保存在R7</p>
<h3 id="jsrr">JSRR</h3>
<p>0100 0 00 BaseR 000000
作用：根据BaseR的值跳转，并且把PC的值保存在R7</p>
<h3 id="ret">RET</h3>
<p>1100 000 111 000000
作用：把R7的值赋给PC</p>
<h3 id="例子取负数">例子：取负数</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>Negate NOT R0,R0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>ADD R0,R0,<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>RET 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>; call the subroutine to compute R4<span style="color:#f92672">=-</span>R3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>AND R0,R0,<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#ae81ff">0</span> ; let R0<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>ADD R0,R0,R3 ; let R0<span style="color:#f92672">=</span>R3
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>JSR Negate
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>AND R4,R4,<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#ae81ff">0</span> ; let R4<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>ADD R4,R4,R0 
</span></span></code></pre></div><h3 id="如何使用">如何使用</h3>
<p>Programmer must know</p>
<ul>
<li>Address: or at least a label that will be bound to its address</li>
<li>Function: what it does
<ul>
<li>NOTE: The programmer does not need to know how the subroutine works, but what changes are visible in the machine’s state after the routine has run</li>
</ul>
</li>
<li>Arguments: what they are and where they are placed</li>
<li>Return values: what they are and where they are placed</li>
</ul>
<h3 id="调用时的信息传递">调用时的信息传递</h3>
<p>Argument(s)</p>
<ul>
<li>Value passed in to a subroutine is called an argument</li>
<li>This is a value needed by the subroutine to do its job</li>
<li>Examples</li>
<li>TwosComp: R0 is number to be negated</li>
<li>OUT: R0 is character to be printed</li>
<li>PUTS: R0 is address of string to be printed</li>
</ul>
<p>传递方法：
How?
In registers (simple, fast, but limited number)
In memory (many, but awkward, expensive)
Both</p>
<p>寄存器和内存进行传递参数</p>
<p>Return Values</p>
<ul>
<li>A value passed out of a subroutine is called a return value</li>
<li>This is the value that you called the subroutine to compute</li>
</ul>
<p>How?
Registers, memory, or both
Single return value in register most common
通常，采用寄存器保存返回值</p>
<h3 id="caller-save-and-caller-save">caller-save and caller-save</h3>
<p>在调用和返回的过程中势必会对寄存器产生修改，那么如何分配保存与恢复现场的责任呢？
一般有两种办法：
caller-save和callee-save
即责任在谁？
caller-save要求调用者来保存相关的寄存器的信息，并且恢复现场。
callee-save要求被调用者来存在相关的信息并且恢复现场。</p>
<p>一般都采用callee-save，只有对于函数返回值R7采用的是caller-save</p>
<p>Generally use “callee-save” strategy, except for return values
Same as trap service routines
Save anything that subroutine alters internally that shouldn’t be visible when the subroutine returns
Restore incoming arguments to original values (unless overwritten by return value)</p>
<p>Remember
<strong>You MUST save R7 if you call any other subroutine or trap</strong>
Otherwise, you won’t be able to return!</p>
<h2 id="chapter8-2-memory-model-for-program-execution--the-stack">Chapter8-2 Memory Model for Program Execution &amp; the Stack</h2>

</article>


<section class="post-nav">
    <ul>
        <li>
        
            <a href="https://blog.oyyko.com/posts/yahang/"><i class="fa fa-chevron-circle-left"></i> 压行技巧</a>
        
        </li>
        <li>
        
            <a href="https://blog.oyyko.com/posts/linklist/">链表 笔记 <i class="fa fa-chevron-circle-right"></i> </a>
        
        </li>
    </ul>
</section>
  
    
    
  





</main>
    <footer>
        <ul>
            <li>
                <h6>
                    Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
                    <a href="https://blog.oyyko.com/index.xml">Subscribe </a></h6>
            </li>
            
            
        </ul>
    </footer>
</div>
<script src="/js/scripts.js"></script>

  


</body>

</html>

