<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Texmacs/Mogan Note 2 · Oyyko
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Oyyko">
<meta name="description" content="23_15 Link to heading 1(get-init-tree &#34;text-at-halign&#34;) 这个与缓存有关。缓存位置在~/.Texmacs/。如果不更改缓存，更改源代码不会生效。
23_7 Link to heading 1(tm-define (graphics-release-left x y) 2 ;;(display* &#34;Graphics] Release-left &#34; x &#34;, &#34; y &#34;\n&#34;) 3 (if (inside-graphical-text?) 4 (with-innermost t graphical-text-context? 5 (let* ((ps (select-first (s2f x) (s2f y))) 6 (p (and ps (car ps)))) 7 (if (and p (list-starts? p (tree-&gt;path t))) 8 (go-to p) 9 (tree-go-to t :start)))) 10 (edit_left-button (car (graphics-mode)) x y))) 1(tm-define (get-keyboard-modifiers) 2 the-keyboard-modifiers) 3 4(tm-define (set-keyboard-modifiers mods) 5 (set!">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Texmacs/Mogan Note 2"/>
<meta name="twitter:description" content="23_15 Link to heading 1(get-init-tree &#34;text-at-halign&#34;) 这个与缓存有关。缓存位置在~/.Texmacs/。如果不更改缓存，更改源代码不会生效。
23_7 Link to heading 1(tm-define (graphics-release-left x y) 2 ;;(display* &#34;Graphics] Release-left &#34; x &#34;, &#34; y &#34;\n&#34;) 3 (if (inside-graphical-text?) 4 (with-innermost t graphical-text-context? 5 (let* ((ps (select-first (s2f x) (s2f y))) 6 (p (and ps (car ps)))) 7 (if (and p (list-starts? p (tree-&gt;path t))) 8 (go-to p) 9 (tree-go-to t :start)))) 10 (edit_left-button (car (graphics-mode)) x y))) 1(tm-define (get-keyboard-modifiers) 2 the-keyboard-modifiers) 3 4(tm-define (set-keyboard-modifiers mods) 5 (set!"/>

<meta property="og:title" content="Texmacs/Mogan Note 2" />
<meta property="og:description" content="23_15 Link to heading 1(get-init-tree &#34;text-at-halign&#34;) 这个与缓存有关。缓存位置在~/.Texmacs/。如果不更改缓存，更改源代码不会生效。
23_7 Link to heading 1(tm-define (graphics-release-left x y) 2 ;;(display* &#34;Graphics] Release-left &#34; x &#34;, &#34; y &#34;\n&#34;) 3 (if (inside-graphical-text?) 4 (with-innermost t graphical-text-context? 5 (let* ((ps (select-first (s2f x) (s2f y))) 6 (p (and ps (car ps)))) 7 (if (and p (list-starts? p (tree-&gt;path t))) 8 (go-to p) 9 (tree-go-to t :start)))) 10 (edit_left-button (car (graphics-mode)) x y))) 1(tm-define (get-keyboard-modifiers) 2 the-keyboard-modifiers) 3 4(tm-define (set-keyboard-modifiers mods) 5 (set!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://oyyko.com/posts/texmacs_note2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-07-13T00:00:00+00:00" />




<link rel="canonical" href="https://oyyko.com/posts/texmacs_note2/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.3177c52908014e036ec6c4e1c8194a1b197b85e669df726c671b40f2e4f77abb.css" integrity="sha256-MXfFKQgBTgNuxsThyBlKGxl7heZp33JsZxtA8uT3ers=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Oyyko
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/projects/">Projects</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://oyyko.com/posts/texmacs_note2/">
              Texmacs/Mogan Note 2
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2023-07-13T00:00:00Z">
                2023-07-13
              </time>
          </div>
          
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/note/">note</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/code/">code</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/mogan/">mogan</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/texmacs/">texmacs</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        
        <hr>
        <i class="fa fa-book"></i> Table of Contents
               <div id="toc"> <nav id="TableOfContents">
  <ul>
    <li><a href="#研究-get-env-tree">研究 get-env-tree</a></li>
    <li><a href="#鼠标点击研究">鼠标点击研究</a></li>
  </ul>
</nav> </div>
        <hr>
        <h1 id="23_15">
  23_15
  <a class="heading-link" href="#23_15">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>(<span style="color:#268bd2">get-init-tree</span> <span style="color:#2aa198">&#34;text-at-halign&#34;</span>)
</span></span></code></pre></div><p>这个与缓存有关。缓存位置在<code>~/.Texmacs/</code>。如果不更改缓存，更改源代码不会生效。</p>
<h1 id="23_7">
  23_7
  <a class="heading-link" href="#23_7">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">graphics-release-left</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span>  <span style="color:#586e75">;;(display* &#34;Graphics] Release-left &#34; x &#34;, &#34; y &#34;\n&#34;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span>  (<span style="color:#719e07">if </span>(<span style="color:#268bd2">inside-graphical-text?</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span>      (<span style="color:#268bd2">with-innermost</span> <span style="color:#268bd2">t</span> <span style="color:#268bd2">graphical-text-context?</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span>        (<span style="color:#719e07">let* </span>((<span style="color:#268bd2">ps</span> (<span style="color:#268bd2">select-first</span> (<span style="color:#268bd2">s2f</span> <span style="color:#268bd2">x</span>) (<span style="color:#268bd2">s2f</span> <span style="color:#268bd2">y</span>)))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span>               (<span style="color:#268bd2">p</span> (<span style="color:#719e07">and </span><span style="color:#268bd2">ps</span> (<span style="color:#b58900">car </span><span style="color:#268bd2">ps</span>))))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span>          (<span style="color:#719e07">if </span>(<span style="color:#719e07">and </span><span style="color:#268bd2">p</span> (<span style="color:#268bd2">list-starts?</span> <span style="color:#268bd2">p</span> (<span style="color:#268bd2">tree-&gt;path</span> <span style="color:#268bd2">t</span>)))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span>              (<span style="color:#268bd2">go-to</span> <span style="color:#268bd2">p</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span>              (<span style="color:#268bd2">tree-go-to</span> <span style="color:#268bd2">t</span> <span style="color:#268bd2">:start</span>))))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span>      (<span style="color:#268bd2">edit_left-button</span> (<span style="color:#b58900">car </span>(<span style="color:#268bd2">graphics-mode</span>)) <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">get-keyboard-modifiers</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>  <span style="color:#268bd2">the-keyboard-modifiers</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">set-keyboard-modifiers</span> <span style="color:#268bd2">mods</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>  (<span style="color:#719e07">set! </span><span style="color:#268bd2">the-keyboard-modifiers</span> <span style="color:#268bd2">mods</span>))
</span></span></code></pre></div><p>结论：https://github.com/XmacsLabs/mogan/pull/796</p>
<h1 id="问题">
  问题
  <a class="heading-link" href="#%e9%97%ae%e9%a2%98">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<ol>
<li>.ts文件怎么使用</li>
<li>C++代码中有很多字符串类型的东西可以用枚举类型来替代，可以重构一下？</li>
<li>绘图模式有没有给座标系标注1、2、3的模式</li>
</ol>
<h1 id="编译时候出现问题">
  编译时候出现问题
  <a class="heading-link" href="#%e7%bc%96%e8%af%91%e6%97%b6%e5%80%99%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>generating scheme glueA glue_font ... ok
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>generating scheme glueA glue_analyze ... ok
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>generating scheme glueA glue_drd ... ok
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>installing libmogan ..
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>error: install failed, method &#39;trim&#39; is not callable (a nil value)
</span></span></code></pre></div><p>看起来是lua语言中的trim方法无法调用。
结论：有一个环境变量字符串被设置为nil，之后在他的上面调用trim方法则报错。</p>
<h1 id="23_14">
  23_14
  <a class="heading-link" href="#23_14">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p><code>edit_interface_rep::handle_mouse</code> 处理鼠标事件。</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>edit_interface_rep<span style="color:#719e07">::</span>handle_mouse (string kind, SI x, SI y, <span style="color:#dc322f">int</span> m, time_t t,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>                                  array<span style="color:#719e07">&lt;</span><span style="color:#dc322f">double</span><span style="color:#719e07">&gt;</span> data)
</span></span></code></pre></div><p>kind的类型可以有move, press-left, release-left, press-right 等。</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span><span style="color:#719e07">else</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span>    string rew<span style="color:#719e07">=</span> kind;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span>    SI dist<span style="color:#719e07">=</span> (SI) (<span style="color:#2aa198">5</span> <span style="color:#719e07">*</span> PIXEL <span style="color:#719e07">/</span> magf);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span>    rew<span style="color:#719e07">=</span> detect_left_drag ((<span style="color:#dc322f">void</span><span style="color:#719e07">*</span>) <span style="color:#719e07">this</span>, rew, x, y, t, m, dist);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span>    <span style="color:#719e07">if</span> (rew <span style="color:#719e07">==</span> <span style="color:#2aa198">&#34;start-drag-left&#34;</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span>      call_mouse_event (rew, left_x, left_y, m, t, data);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span>      delayed_call_mouse_event (<span style="color:#2aa198">&#34;dragging-left&#34;</span>, x, y, m, t, data);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span>    <span style="color:#719e07">else</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span>      rew<span style="color:#719e07">=</span> detect_right_drag ((<span style="color:#dc322f">void</span><span style="color:#719e07">*</span>) <span style="color:#719e07">this</span>, rew, x, y, t, m, dist);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span>      <span style="color:#719e07">if</span> (rew <span style="color:#719e07">==</span> <span style="color:#2aa198">&#34;start-drag-right&#34;</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span><span>        call_mouse_event (rew, right_x, right_y, m, t, data);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span><span>        delayed_call_mouse_event (<span style="color:#2aa198">&#34;dragging-right&#34;</span>, x, y, m, t, data);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span><span>      }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span><span>      <span style="color:#719e07">else</span> <span style="color:#268bd2">call_mouse_event</span> (rew, x, y, m, t, data);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span><span>  }
</span></span></code></pre></div><p>这段检测了是否有拖动发生，如果没有，最终会执行<code>call_mouse_event (rew, x, y, m, t, data);</code></p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span><span style="color:#719e07">static</span> <span style="color:#dc322f">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span><span style="color:#268bd2">call_mouse_event</span> (string kind, SI x, SI y, SI m, time_t t, array<span style="color:#719e07">&lt;</span><span style="color:#dc322f">double</span><span style="color:#719e07">&gt;</span> d) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  array<span style="color:#719e07">&lt;</span>object<span style="color:#719e07">&gt;</span> args;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>  args <span style="color:#719e07">&lt;&lt;</span> object (kind) <span style="color:#719e07">&lt;&lt;</span> object (x) <span style="color:#719e07">&lt;&lt;</span> object (y)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>       <span style="color:#719e07">&lt;&lt;</span> object (m) <span style="color:#719e07">&lt;&lt;</span> object ((<span style="color:#dc322f">double</span>) t) <span style="color:#719e07">&lt;&lt;</span> object (d);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>  call (<span style="color:#2aa198">&#34;mouse-event&#34;</span>, args);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span><span>}
</span></span></code></pre></div><p>然后转发给scheme来处理。</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">mouse-event</span> <span style="color:#268bd2">key</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span> <span style="color:#268bd2">mods</span> <span style="color:#268bd2">time</span> <span style="color:#268bd2">data</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>  <span style="color:#586e75">;;(display* &#34;mouse-event &#34; key &#34;, &#34; x &#34;, &#34; y &#34;, &#34; mods &#34;, &#34; time &#34;, &#34; data &#34;\n&#34;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  (<span style="color:#268bd2">mouse-any</span> <span style="color:#268bd2">key</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span> <span style="color:#268bd2">mods</span> (<span style="color:#b58900">+ </span><span style="color:#268bd2">time</span> <span style="color:#2aa198">0.0</span>) <span style="color:#268bd2">data</span>))
</span></span></code></pre></div><p>转到<code>mouse-any</code></p>
<p><code>mouse-any</code>再转回C++</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span>                scm_name <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;mouse-any&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span>                cpp_name <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;mouse_any&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span>                ret_type <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;void&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span>                arg_list <span style="color:#719e07">=</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span>                    <span style="color:#2aa198">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span>                    <span style="color:#2aa198">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span>                    <span style="color:#2aa198">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span>                    <span style="color:#2aa198">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span>                    <span style="color:#2aa198">&#34;double&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span>                    <span style="color:#2aa198">&#34;array_double&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span><span>                }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span><span>            },
</span></span></code></pre></div><p>在<code>mouse_any</code>中进行dispatch.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>  <span style="color:#719e07">if</span> (type <span style="color:#719e07">==</span> <span style="color:#2aa198">&#34;press-left&#34;</span> <span style="color:#719e07">||</span> type <span style="color:#719e07">==</span> <span style="color:#2aa198">&#34;start-drag-left&#34;</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>    <span style="color:#719e07">if</span> (mods <span style="color:#719e07">&gt;</span> <span style="color:#2aa198">1</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>      mouse_adjusting <span style="color:#719e07">=</span> mods;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>      mouse_adjust_selection(x, y, mods);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>    } <span style="color:#719e07">else</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>      <span style="color:#268bd2">mouse_click</span> (x, y);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span><span>  }
</span></span></code></pre></div><p>在这里进入mouse_click函数</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span><span style="color:#dc322f">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>edit_interface_rep<span style="color:#719e07">::</span>mouse_click (SI x, SI y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  <span style="color:#719e07">if</span> (mouse_message (<span style="color:#2aa198">&#34;click&#34;</span>, x, y)) <span style="color:#719e07">return</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>  start_x<span style="color:#719e07">=</span> x;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>  start_y<span style="color:#719e07">=</span> y;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>  send_mouse_grab (<span style="color:#719e07">this</span>, <span style="color:#b58900">true</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span><span>}
</span></span></code></pre></div><p>思路改为倒着找，从绘图的移动功能出发。因为只需要在绘图上进行改变鼠标样式的操作，而改变鼠标样式(<code>setCursor</code>)是依赖于具体的widget来执行的。</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">edit_move</span> <span style="color:#268bd2">mode</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">graphics-move</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>  <span style="color:#586e75">;;(display* &#34;Graphics] Move &#34; x &#34;, &#34; y &#34;\n&#34;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  (<span style="color:#268bd2">when</span> (<span style="color:#b58900">not </span>(<span style="color:#268bd2">inside-graphical-text?</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>    (<span style="color:#268bd2">edit_move</span> (<span style="color:#b58900">car </span>(<span style="color:#268bd2">graphics-mode</span>)) <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)))
</span></span></code></pre></div><p>根据<code>(&quot;Move objects&quot; (graphics-set-mode '(group-edit move)))</code>, 应该重载到group-edit版本。</p>
<p>测试发现正确:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">edit_move</span> <span style="color:#268bd2">mode</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span>  (<span style="color:#268bd2">:require</span> (<span style="color:#b58900">eq? </span><span style="color:#268bd2">mode</span> <span style="color:#2aa198">&#39;group-edit</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span>  (<span style="color:#268bd2">:state</span> <span style="color:#268bd2">graphics-state</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span>  (<span style="color:#268bd2">display*</span> <span style="color:#2aa198">&#34;HERE\n&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span>  (<span style="color:#719e07">cond </span>(<span style="color:#268bd2">sticky-point</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span>         (<span style="color:#719e07">set! </span><span style="color:#268bd2">x</span> (<span style="color:#268bd2">s2f</span> <span style="color:#268bd2">x</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span>         (<span style="color:#719e07">set! </span><span style="color:#268bd2">y</span> (<span style="color:#268bd2">s2f</span> <span style="color:#268bd2">y</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span>         (<span style="color:#268bd2">with</span> <span style="color:#268bd2">mode</span> (<span style="color:#268bd2">graphics-mode</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span>           (<span style="color:#719e07">cond </span>((<span style="color:#268bd2">==</span> (<span style="color:#b58900">cadr </span><span style="color:#268bd2">mode</span>) <span style="color:#2aa198">&#39;move</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span>                  (<span style="color:#268bd2">sketch-transform</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span>                   (<span style="color:#268bd2">group-translate</span> (<span style="color:#b58900">- </span><span style="color:#268bd2">x</span> <span style="color:#268bd2">group-old-x</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span><span>                                    (<span style="color:#b58900">- </span><span style="color:#268bd2">y</span> <span style="color:#268bd2">group-old-y</span>))))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span><span>                 ((<span style="color:#268bd2">==</span> (<span style="color:#b58900">cadr </span><span style="color:#268bd2">mode</span>) <span style="color:#2aa198">&#39;zoom</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span><span>                  (<span style="color:#268bd2">sketch-set!</span> <span style="color:#268bd2">group-first-go</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span><span>                  (<span style="color:#268bd2">sketch-transform</span> (<span style="color:#268bd2">group-zoom</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span><span>                 ((<span style="color:#268bd2">==</span> (<span style="color:#b58900">cadr </span><span style="color:#268bd2">mode</span>) <span style="color:#2aa198">&#39;rotate</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span><span>                  (<span style="color:#268bd2">sketch-set!</span> <span style="color:#268bd2">group-first-go</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span><span>                  (<span style="color:#268bd2">sketch-transform</span> (<span style="color:#268bd2">group-rotate</span> <span style="color:#268bd2">x</span> <span style="color:#268bd2">y</span>)))))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span><span>         (<span style="color:#719e07">set! </span><span style="color:#268bd2">group-old-x</span> <span style="color:#268bd2">x</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span><span>         (<span style="color:#719e07">set! </span><span style="color:#268bd2">group-old-y</span> <span style="color:#268bd2">y</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span><span>        (<span style="color:#268bd2">multiselecting</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span><span>         (<span style="color:#268bd2">graphical-object!</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span><span>          (<span style="color:#268bd2">append</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span><span>           (<span style="color:#268bd2">create-graphical-props</span> <span style="color:#2aa198">&#39;default</span> <span style="color:#cb4b16">#f</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span><span>           <span style="color:#719e07">`</span>((<span style="color:#268bd2">with</span> <span style="color:#268bd2">color</span> <span style="color:#268bd2">red</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span><span>               (<span style="color:#268bd2">cline</span> (<span style="color:#268bd2">point</span> <span style="color:#719e07">,</span><span style="color:#268bd2">selecting-x0</span> <span style="color:#719e07">,</span><span style="color:#268bd2">selecting-y0</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span><span>                      (<span style="color:#268bd2">point</span> <span style="color:#719e07">,</span><span style="color:#268bd2">x</span> <span style="color:#719e07">,</span><span style="color:#268bd2">selecting-y0</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span><span>                      (<span style="color:#268bd2">point</span> <span style="color:#719e07">,</span><span style="color:#268bd2">x</span> <span style="color:#719e07">,</span><span style="color:#268bd2">y</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span><span>                      (<span style="color:#268bd2">point</span> <span style="color:#719e07">,</span><span style="color:#268bd2">selecting-x0</span> <span style="color:#719e07">,</span><span style="color:#268bd2">y</span>)))))))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span><span>        (<span style="color:#268bd2">else</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span><span>          (<span style="color:#719e07">cond </span>(<span style="color:#268bd2">current-path</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span><span>                 (<span style="color:#268bd2">set-message</span> (<span style="color:#b58900">string-append </span><span style="color:#2aa198">&#34;Left click: operate; &#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span><span>                                             <span style="color:#2aa198">&#34;Shift+Left click or Right click: select/unselect&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34</span><span>                              <span style="color:#2aa198">&#34;Group of objects&#34;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35</span><span>                ((<span style="color:#268bd2">nnull?</span> (<span style="color:#268bd2">sketch-get</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36</span><span>                 (<span style="color:#268bd2">set-message</span> <span style="color:#2aa198">&#34;Left click: operate&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37</span><span>                              <span style="color:#2aa198">&#34;Group of objects&#34;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38</span><span>                (<span style="color:#268bd2">else</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39</span><span>                  (<span style="color:#268bd2">set-message</span> <span style="color:#2aa198">&#34;Move over object on which to operate&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">40</span><span>                               <span style="color:#2aa198">&#34;Edit groups of objects&#34;</span>)))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">41</span><span>          (<span style="color:#268bd2">graphics-decorations-update</span>))))
</span></span></code></pre></div><p>之后倒到<code>edit_graphics.cpp</code>中的:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span><span style="color:#dc322f">bool</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>edit_graphics_rep<span style="color:#719e07">::</span>mouse_graphics (string type, SI x, SI y, <span style="color:#dc322f">int</span> mods, time_t t,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>                                   array<span style="color:#719e07">&lt;</span><span style="color:#dc322f">double</span><span style="color:#719e07">&gt;</span> data) {
</span></span></code></pre></div><p>倒退到</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span><span style="color:#dc322f">bool</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>edit_graphics_rep<span style="color:#719e07">::</span>mouse_graphics (string type, SI x, SI y, <span style="color:#dc322f">int</span> mods, time_t t,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>                                   array<span style="color:#719e07">&lt;</span><span style="color:#dc322f">double</span><span style="color:#719e07">&gt;</span> data) {
</span></span></code></pre></div><p>然后倒退到scheme中。没找到可以利用的。</p>
<p>换思路，搜索<code>: public QWidget</code>,看都有谁继承了。因为setCursor是它的成员函数。QtMainWindow也是Qt库中的，它也继承了QWidget.</p>
<p>看不出。直接看主界面怎么生成的吧。</p>
<p><code>qt_tm_widget.hpp</code>中写了：</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>  QMainWindow<span style="color:#719e07">*</span> <span style="color:#268bd2">mainwindow</span> () {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>    <span style="color:#719e07">return</span> qobject_cast<span style="color:#719e07">&lt;</span>QMainWindow<span style="color:#719e07">*&gt;</span> (qwid); 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  }
</span></span></code></pre></div><p>这个函数可以获取主页面的QWidget. 但它仍然是一个成员函数所以可能不太对。</p>
<p>在<code>qt_dialogues.cpp</code>中,发现了</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span> QWidget<span style="color:#719e07">*</span> mainwindow <span style="color:#719e07">=</span> QApplication<span style="color:#719e07">::</span>activeWindow ();
</span></span></code></pre></div><p>这个可能是Qt自带的找到当前活跃窗口的函数。</p>
<h1 id="23_14-bug">
  23_14 Bug
  <a class="heading-link" href="#23_14-bug">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span>(<span style="color:#268bd2">tm-define</span> (<span style="color:#268bd2">graphics-get-property</span> <span style="color:#268bd2">var</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span>  (<span style="color:#268bd2">with</span> <span style="color:#268bd2">val</span> (<span style="color:#268bd2">graphics-get-raw-property</span> <span style="color:#268bd2">var</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span>    (<span style="color:#268bd2">tm-&gt;stree</span> <span style="color:#268bd2">val</span>)))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span>(<span style="color:#719e07">define </span>(<span style="color:#268bd2">graphics-get-raw-property</span> <span style="color:#268bd2">var</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span>  (<span style="color:#268bd2">with</span> <span style="color:#268bd2">val</span> (<span style="color:#268bd2">get-upwards-tree-property</span> (<span style="color:#268bd2">graphics-graphics-path</span>) <span style="color:#268bd2">var</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span>    (<span style="color:#719e07">if </span>(<span style="color:#b58900">eq? </span><span style="color:#268bd2">val</span> <span style="color:#268bd2">nothing</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span>        (<span style="color:#268bd2">get-default-tree-val</span> <span style="color:#268bd2">var</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span>        (<span style="color:#719e07">if </span>(<span style="color:#b58900">eq? </span>(<span style="color:#268bd2">tm-car</span> <span style="color:#268bd2">val</span>) <span style="color:#2aa198">&#39;quote</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span>            (<span style="color:#268bd2">tree-ref</span> <span style="color:#268bd2">val</span> <span style="color:#2aa198">0</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span>            <span style="color:#268bd2">val</span>))))
</span></span></code></pre></div><h2 id="研究-get-env-tree">
  研究 get-env-tree
  <a class="heading-link" href="#%e7%a0%94%e7%a9%b6-get-env-tree">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>tree
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>edit_typeset_rep<span style="color:#719e07">::</span>get_env_value (string var, path p) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  typeset_exec_until (p);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>  tree t<span style="color:#719e07">=</span> cur[p][var];
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>  <span style="color:#719e07">return</span> <span style="color:#268bd2">is_func</span> (t, BACKUP, <span style="color:#2aa198">2</span>)<span style="color:#719e07">?</span> t[<span style="color:#2aa198">0</span>]<span style="color:#719e07">:</span> t;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>}
</span></span></code></pre></div><h2 id="鼠标点击研究">
  鼠标点击研究
  <a class="heading-link" href="#%e9%bc%a0%e6%a0%87%e7%82%b9%e5%87%bb%e7%a0%94%e7%a9%b6">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>  <span style="color:#719e07">if</span> (type <span style="color:#719e07">==</span> <span style="color:#2aa198">&#34;press-left&#34;</span> <span style="color:#719e07">||</span> type <span style="color:#719e07">==</span> <span style="color:#2aa198">&#34;start-drag-left&#34;</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>    <span style="color:#719e07">if</span> (mods <span style="color:#719e07">&gt;</span> <span style="color:#2aa198">1</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>      mouse_adjusting <span style="color:#719e07">=</span> mods;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>      mouse_adjust_selection(x, y, mods);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>    } <span style="color:#719e07">else</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>      <span style="color:#268bd2">mouse_click</span> (x, y);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span><span>  }
</span></span></code></pre></div><p>之后进入</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span><span style="color:#dc322f">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>edit_interface_rep<span style="color:#719e07">::</span>mouse_click (SI x, SI y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  cout <span style="color:#719e07">&lt;&lt;</span> <span style="color:#2aa198">&#34;DEBUG: &#34;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>  <span style="color:#719e07">if</span> (mouse_message (<span style="color:#2aa198">&#34;click&#34;</span>, x, y)) <span style="color:#719e07">return</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>  start_x<span style="color:#719e07">=</span> x;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>  start_y<span style="color:#719e07">=</span> y;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span><span>  send_mouse_grab (<span style="color:#719e07">this</span>, <span style="color:#b58900">true</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span><span>}
</span></span></code></pre></div><p>之后</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span><span style="color:#268bd2">inline</span> <span style="color:#dc322f">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span><span style="color:#268bd2">send_mouse_grab</span> (widget w, <span style="color:#dc322f">bool</span> get_grab) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>  <span style="color:#586e75">// request a mouse grab for the widget
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span><span style="color:#586e75"></span>  send<span style="color:#719e07">&lt;</span><span style="color:#dc322f">bool</span><span style="color:#719e07">&gt;</span> (w, SLOT_MOUSE_GRAB, get_grab);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>}
</span></span></code></pre></div><p>在这里似乎捕获了</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span><span style="color:#dc322f">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span>qt_tm_widget_rep<span style="color:#719e07">::</span>send (slot s, blackbox val) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span>  <span style="color:#719e07">switch</span> (s) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span>    <span style="color:#719e07">case</span> SLOT_INVALIDATE:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span>    <span style="color:#719e07">case</span> SLOT_INVALIDATE_ALL:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span>    <span style="color:#719e07">case</span> SLOT_EXTENTS:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span>    <span style="color:#719e07">case</span> SLOT_SCROLL_POSITION:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span>    <span style="color:#719e07">case</span> SLOT_ZOOM_FACTOR:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span>    <span style="color:#719e07">case</span> SLOT_MOUSE_GRAB:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span>      main_widget<span style="color:#719e07">-&gt;</span>send(s, val);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span>      <span style="color:#719e07">return</span>;
</span></span></code></pre></div><p>似乎会跑到这里</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>    <span style="color:#719e07">case</span> SLOT_MOUSE_GRAB:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>    {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>      check_type<span style="color:#719e07">&lt;</span><span style="color:#dc322f">bool</span><span style="color:#719e07">&gt;</span> (val, s);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>      <span style="color:#dc322f">bool</span> grab <span style="color:#719e07">=</span> open_box<span style="color:#719e07">&lt;</span><span style="color:#dc322f">bool</span><span style="color:#719e07">&gt;</span>(val);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>      <span style="color:#719e07">if</span> (grab <span style="color:#719e07">&amp;&amp;</span> canvas() <span style="color:#719e07">&amp;&amp;</span> <span style="color:#719e07">!</span>canvas()<span style="color:#719e07">-&gt;</span>hasFocus())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span>        canvas()<span style="color:#719e07">-&gt;</span>setFocus (Qt<span style="color:#719e07">::</span>MouseFocusReason);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span><span>      <span style="color:#719e07">break</span>;
</span></span></code></pre></div>
      </div>


      <footer>
        


        
        
        <div class="comments">
    <script>
  
    let getTheme = window.localStorage && window.localStorage.getItem("colorscheme");
  
    getTheme = getTheme == null ? 'github-light' : getTheme;
    
    let theme = getTheme === 'dark' ? 'github-dark' : 'github-light';
    let s = document.createElement('script');
    s.src = 'https://utteranc.es/client.js';
    s.setAttribute('repo', 'oyyko\/utteranc-comments');
    s.setAttribute('issue-term', 'pathname');
    s.setAttribute('theme', theme);
    s.setAttribute('crossorigin', 'anonymous');
    s.setAttribute('async', '');
    document.querySelector('div.comments').innerHTML = '';
    document.querySelector('div.comments').appendChild(s);
  
    </script>
    </div>
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <link rel='stylesheet' type='text/css' href=http://fonts.googleapis.com/css?family&#61;Jetbrains&#43;Mono%7cRoboto&#43;Slab%7cNoto&#43;Sans&#43;SC%7c>


    <section class="container">
      ©
      
      2019 -
      
      2023
       Oyyko 
      ·
      
      Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a
        href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a> Modified by <a
        href="https://oyyko.com" target="_blank" rel="noopener">Oyyko </a>.
      
    </section>
</footer>
  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
